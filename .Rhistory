source("~/Dropbox/courses/booksbsMySelf/02bookStat/bookStat/scriptEjercicios/rls2.r")
##!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##+ I. Datos para ejemplo
##!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
library(datana)
data(fishgrowth2)
df <- fishgrowth2
#?fishgrowth2 #ejecutelo en la consola
head(df)
dim(df)
str(df)
##+ Se necesita la  librer\'ia MASS,  para definir vector 'yvec'
library(MASS)
plot(largo~edad, data=df)
##+ Se necesita la  librer\'ia MASS,  para definir vector 'yvec'
library(MASS)
yvec[1:7] #veamos las primeras siete observaciones
yvec <- df$largo #vector de la variable respuesta
yvec[1:7] #veamos las primeras siete observaciones
n<-length(yvec)
n
##- y la matriz  X
xvec <-  df$edad
Xmat <- cbind(rep(1, n), xvec)
Xmat[1:10,] #veamos las primeras diez observaciones
##> Ahora tenemos todo lo necesario para calcular el vector
##> de parametros estimados mediante formula matricial
beta.hat.vec <- ginv(t(Xmat) %*% Xmat) %*% (t(Xmat) %*% yvec)
beta.hat.vec
## revise las dimensiones de
dim(beta.hat.vec)
q<-nrow(beta.hat.vec) #numero de coeficientes
b0.hat<-beta.hat.vec[1];b0.hat
b1.hat<-beta.hat.vec[2];b1.hat
##+ Ahora calcular la varianza de los residuales
##- (1) calcular la matriz "hat"
Hmat<- Xmat  %*% ginv(t(Xmat) %*% Xmat) %*% (t(Xmat))
beta.hat.vec
Imat<- diag(n)
##- (2) la varianza
var.hat.e<- ( t(yvec)  %*% (Imat - Hmat) %*% yvec) /(n-(q+1))
var.hat.e
var.hat.e<-as.numeric(var.hat.e)
var.hat.e
sqrt(var.hat.e) #desv. estandar de los residuales del modelo
##! compare resultado anterior con el que se obtiene al aplicar
##! la funcion lm() de R
mod.lm<- lm(largo~edad,data=df)
summary(mod.lm)
coef(mod.lm)
(summary(mod.lm))$sigma
##!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##+ III. Varianza de los parametros estimados
##!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##+
##- (1) calcular la matriz covarianza-varianza
##* primero
mat.xxinv<- (ginv(t(Xmat) %*% Xmat))
mat.xxinv
mat.cov.betas.ols<- var.hat.e * mat.xxinv
mat.cov.betas.ols
##- (2) la varianza de los beta.ols
var.betas.ols<- diag(mat.cov.betas.ols)
var.betas.ols
summary(mod.lm)
getwd()
sm<-read.csv(file = "sugarMapleBiomass.csv")
head(sm)
plot(leaf~ba, data=df)
plot(leaf~ba, data=sm)
#ajuste un RLS
m1.sm <- lm(leaf~ba, data=sm)
summary(m1.sm)
plot(m1.sm)
plot(m1.sm)
#WLS
m2.sm <- lm(leaf~ba, data=sm, weights = I(ba^-1))
summary(m2.sm)
summary(m1.sm)
summary(m2.sm)
c(AIC(m1.sm),AIC(m2.sm))
c(BIC(m1.sm),BIC(m2.sm))
plot(m2.sm)
plot(m2.sm)
m3.sm <- lm(leaf~ba, data=sm, weights = I(ba^-2))
summary(m3.sm)
c(AIC(m1.sm),AIC(m2.sm),AIC(m3.sm))
c(BIC(m1.sm),BIC(m2.sm),BIC(m3.sm))
plot(m3.sm)
require(nlme)
m2b.sm <- gls(leaf~ba, data=sm, weights = varFixed(~ba))
summary(m2b.sm)
###
m4.sm <- gls(leaf~ba, data=sm, weights = varPower(form=~ba))
summary(m4.sm)
c(AIC(m1.sm),AIC(m2.sm),AIC(m3.sm),AIC(m4.sm))
c(BIC(m1.sm),BIC(m2.sm),BIC(m3.sm),BIC(m4.sm))
plot(m4.sm)
abline(h=0)
##
m5.sm <- gls(leaf~ba, data=sm, weights = varConstPower(form=~ba))
summary(m5.sm)
##
m5.sm <- gls(leaf~ba, data=sm, weights = varConstPower(form=~ba))
summary(m5.sm)
c(AIC(m1.sm),AIC(m2.sm),AIC(m3.sm),AIC(m4.sm),AIC(m5.sm))
c(BIC(m1.sm),BIC(m2.sm),BIC(m3.sm),BIC(m4.sm),BIC(m5.sm))
summary(m4.sm)
##! Script: "regrenl1.r"                                        /
##- Sobre:  Ajuste de modelo de regresion no lineal   /
##+ Detalles:  Emplea datos de peso de hojas                   /
## -----------------------------------------------------------/
##                                                           /
## Profesor: Christian Salas Eljatib                        /
## E-mail: christian.salas AT uchile DOT cl                /
## Web: https://eljatib.com                               /
##=======================================================/
df <- read.csv("..//data/leafw2.csv", header=T)
dim(df)
df$r.peso <- sqrt(df$peso)
df$inv.rpeso <- 1 / sqrt(df$peso)
df$ln.peso <- log(df$peso)
library(datana)
descstat(df[,c("area","peso")])
op <- par(las=1,mfrow=c(2,2))
plot(area~peso, data=df,
ylab="Area foliar (cm^2)",
xlab="Peso foliar (gr)")
plot(area~ln.peso, data=df,
ylab="Area foliar (cm^2)",
xlab="ln[Peso foliar] (ln[gr])")
plot(area~r.peso, data=df,
ylab="Area foliar (cm^2)",
xlab="sqrt[Peso foliar] (sqrt[gr])")
plot(area~inv.rpeso,data=df,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
par(op)
source("~/Dropbox/courses/booksbsMySelf/02bookStat/bookStat/scriptEjercicios/comportarls2.r")
source("~/Dropbox/courses/booksbsMySelf/02bookStat/bookStat/scriptEjercicios/comportarls1.r")
df <- read.csv("..//data/leafw2.csv", header=T)
dim(df)
head(df)
str(df)
library(datana)
##-Cuadro de estadistica descriptiva para dos variables
descstat(df[,c("peso","area")])
df$r.peso <- sqrt(df$peso)
df$inv.rpeso <- 1 / sqrt(df$peso)
df$ln.peso <- log(df$peso)
descstat(df)
plot(area~peso, data=df,
ylab="Area foliar (cm^2)",
xlab="Peso foliar (gr)")
plot(area~ln.peso, data=df,
ylab="Area foliar (cm^2)",
xlab="ln[Peso foliar] (ln[gr])")
plot(area~r.peso, data=df,
ylab="Area foliar (cm^2)",
xlab="sqrt[Peso foliar] (sqrt[gr])")
plot(area~inv.rpeso,data=df,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
df <- read.csv("..//data/leafw2.csv", header=T)
dim(df)
head(df)
str(df)
library(datana)
##-Cuadro de estadistica descriptiva para dos variables
descstat(df[,c("peso","area")])
df$r.peso <- sqrt(df$peso)
df$inv.rpeso <- 1 / sqrt(df$peso)
df$ln.peso <- log(df$peso)
descstat(df)
##!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##+# II. Graficos de interes
##!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
op <- par(las=1,mfrow=c(2,2))
plot(area~peso, data=df,
ylab="Area foliar (cm^2)",
xlab="Peso foliar (gr)")
plot(area~ln.peso, data=df,
ylab="Area foliar (cm^2)",
xlab="ln[Peso foliar] (ln[gr])")
plot(area~r.peso, data=df,
ylab="Area foliar (cm^2)",
xlab="sqrt[Peso foliar] (sqrt[gr])")
plot(area~inv.rpeso,data=df,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
par(op)
#ajuste modelo
# area =b0+b1(1/sqrt(peso))
hoja.rls <- lm(area~inv.rpeso, data=df)
summary(hoja.rls)
df$fit.slr <- fitted(hoja.rls)
df$sr.rls <- rstudent(hoja.rls)
#graficos de diagnostico
op <- par(las=1,mfrow=c(2,2))
plot(area~inv.rpeso,data=df,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
abline(reg=hoja.rls,col="red",lwd=2)
plot(sr.rls~inv.rpeso, data=df,
col=ifelse(abs(sr.rls)<2, "green", "red"),
cex=ifelse(abs(sr.rls)<2, 1, 1.0),
ylab=expression("Residual estudentizado " (cm^2)),
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
abline(h=c(-2,0,2), col="black", lty=2)
plot(sr.rls~fit.slr, data=df, col=ifelse(abs(sr.rls)<2, "green", "red"),
cex=ifelse(abs(sr.rls)<2, 1, 1.00),
ylab=expression("Residual estudentizado " (cm^2)),
xlab="Valor ajustado")
abline(h=c(-2,0,2), col="black", lty=2)
# assess normality with qq plot
res_qq4 <- qqnorm(df$sr.rls)#, col="blue")
qqline(df$sr.rls, col="red")
shapiro.test(df$sr.rls)
par(op)
#ajuste modelos
#Ajuste modelo 1
#y=b0+b1*x
mod1<- lm(area~peso, data=df)
mod3<- lm(area~r.peso,data=df)
mod3<- lm(area~ln.peso,data=df)
#ajuste modelos
mod1<- lm(area~peso, data=df)
mod3<- lm(area~r.peso,data=df)
mod3<- lm(area~ln.peso,data=df)
mod4<- lm(area~inv.rpeso,data=df)
summary(mod1)
plot(area~inv.rpeso,data=df,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
abline(mod4)
plot(area~inv.rpeso,data=df,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
abline(mod4,col="red")
plot(area~inv.rpeso,data=df,las=1,
ylab="Area foliar (cm^2)",
xlab="inv.sqrt(Peso foliar (inv.sqrt[g]))")
abline(mod4,col="red")
#grafico de comportamiento-modelo 1
x.fake <- seq(0.05,0.2,by=0.01)
#grafico de comportamiento-modelo 1
x.fake <- seq(0.05,0.2,by=0.01)
length(x.fake)
y.ajumod4 <- b0.hat + b1.hat * (1/(sqrt(x.fake)))
plot(area~peso, data=df)
lines(x.fake, y.ajumod1, col="red",lwd=2)
lines(x.fake, y.ajumod4, col="red",lwd=2)
#guardando los coeficientes en un objeto
coef(mod4)
coef(mod4)[1]
b0.hat<-coef(mod4)[1]
b1.hat<-coef(mod4)[2]
#grafico de comportamiento-modelo 1
x.fake <- seq(0.05,0.2,by=0.01)
length(x.fake)
#grafico de comportamiento-modelo 1
x.fake <- seq(0.05,0.2,by=0.01)
length(x.fake)
y.ajumod4 <- b0.hat +
b1.hat * (1/(sqrt(x.fake)))
plot(area~peso, data=df)
lines(x.fake, y.ajumod4, col="red",lwd=2)
#grafico de comportamiento-modelo 1
x.fake <- seq(0.03,0.2,by=0.01)
length(x.fake)
y.ajumod4 <- b0.hat +
b1.hat * (1/(sqrt(x.fake)))
plot(area~peso, data=df)
lines(x.fake, y.ajumod4, col="red",lwd=2)
#grafico de comportamiento-modelo 1
x.fake <- seq(0.04,0.2,by=0.01)
length(x.fake)
y.ajumod4 <- b0.hat +
b1.hat * (1/(sqrt(x.fake)))
plot(area~peso, data=df)
lines(x.fake, y.ajumod4, col="red",lwd=2)
##+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##!# I. Empleando la funcion de Weibull
##+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
#revisar la siguiente funcion
#?dweibull
## cuantos parametros tiene?
dweibull(10, shape=.2, scale = 30)
##+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##!# II. Graficando la funcion
##+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
#varios valores de Y
y<-1:100
f.y<-dweibull(y,shape=.2, scale = 23)
plot(f.y~y, type="l", ylab = "f(y)",las=1)
f.y.b<-dweibull(y,shape=2, scale = 23)
plot(f.y.b~y, type="l", ylab = "f(y)",las=1)
#en un mismo grafico las dos curvas
plot(f.y~y, type="l", ylab = "f(y)",las=1)
lines(y,f.y.b, type="l", col="red")
##+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
##!# III. Datos para ejemplo
##+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
library(datana)
##- revisar metadata al activar siguiente linea
#?lifexpect
data(lifexpect)
df <- lifexpect
head(df)
dim(df)
df$y<-df$life.expectancy
##- Grafico de distribucion
hist(df$y)
hist(df$y, xlim=c(0,100))
boxplot(df$y)
##- Aca se define (por Ud) una funcion que calcule la funcion
##-  del logaritmo de la verosimilitud
loglike.wei <-function(parametros=parametros,
data=data){
-sum(dweibull(data, shape=parametros[1],scale=parametros[2],log = T))
}
##la que tiene un signo negativo antes de la funcion
loglike.wei(c(.2,23),df$y)
loglike.wei(c(2,23),df$y)
##valores iniciales para los parametros a ser estimados
summary(df$y)
descstat(df$y)
descstat(df$y,full = TRUE)
candidatos<-c(.2,70)
candidatos
##?optim
optim.loglik.wei<-optim(c(candidatos[1],candidatos[2]),
loglike.wei,data=df$y)
optim.loglik.wei
names(optim.loglik.wei)
optim.loglik.wei$par
optim.loglik.wei$par[1]
alpha.mle<-shape.mle<-optim.loglik.wei$par[1]
shape.mle
beta.mle<-scale.mle<-optim.loglik.wei$par[2]
scale.mle
#- (a) La frecuencia relativa para la muestra
summary(df$y)
diff(range(df$y))
40/5
w.amp<-5
breaks.yo<-c(0,seq(5,100,by=w.amp))
breaks.yo
y.class <- findInterval(df$y, breaks.yo)
y.class<-y.class*w.amp
head(cbind(df$y,y.class))
y.class <- factor(y.class); y.class
table(y.class)
sum(table(y.class))
y.tab.rel<-table(y.class)/nrow(df)
sum(y.tab.rel)
plot(y.tab.rel,las=1,ylab="Frecuencia relativa",
xlab="Esperanza de vida (a\u00f1os)",ylim=c(0,0.35))
